Helm chart  that will reset all nodes ssh public key ,and will allow you to login to the node from the pod.

Usage :
1. First clone the repo 
2. then run the following command :

helm install sshaccess-0.1.0.tgz --set sub="subid" --set rg="MC_location" --set token="az account get-access-token -paste the output" --set newssh="the new ssh key[public] --set location="MC_location"


example :

helm install sshaccess-0.1.0.tgz --set sub="928f4e7e-2c28-4063-a56e-6f1e6f2bb73c" --set rg="MC_latestversion_kubelatest_eastus" --set token="eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ii1zeE1KTUxDSURXTVRQdlp5SjZ0eC1DRHh3MCIsImtpZCI6Ii1zeE1KTUxDSURXTVRQdlp5SjZ0eC1DRHh3MCJ9.eyJhdWQiOiJodHRwczovL21hbmFnZW1lbnQuY29yZS53aW5kb3dzLm5ldC8iLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC83MmY5ODhiZi04NmYxLTQxYWYtOTFhYi0yZDdjZDAxMWRiNDcvIiwiaWF0IjoxNTUxNTM0MjE4LCJuYmYiOjE1NTE1MzQyMTgsImV4cCI6MTU1MTUzODExOCwiX2NsYWltX25hbWVzIjp7Imdyb3VwcyI6InNyYzEifSwiX2NsYWltX3NvdXJjZXMiOnsic3JjMSI6eyJlbmRwb2ludCI6Imh0dHBzOi8vZ3JhcGgud2luZG93cy5uZXQvNzJmOTg4YmYtODZmMS00MWFmLTkxYWItMmQ3Y2QwMTFkYjQ3L3VzZXJzLzRkY2U1MGVlLWMyZGMtNGQwMy1hYjJiLTllMTVhMGMxZDdlMi9nZXRNZW1iZXJPYmplY3RzIn19LCJhY3IiOiIxIiwiYWlvIjoiQVZRQXEvOEtBQUFBREJXd2ZHU3FkMWlPZUl4Qm5RZW14cVErV2ZURllPUS9nbVVJM2VVaG5Bemc3ZjBVN1ZBRk1ZdStaZzBFK0xvNEFsbXl5YjF3MDJscVJIY0pGNEJ2RHZpcjVab0xnV0JYbFZWUXJDTkFCRms9IiwiYW1yIjpbInB3ZCIsIm1mYSJdLCJhcHBpZCI6IjA0YjA3Nzk1LThkZGItNDYxYS1iYmVlLTAyZjllMWJmN2I0NiIsImFwcGlkYWNyIjoiMCIsImZhbWlseV9uYW1lIjoiR2VsZXIiLCJnaXZlbl9uYW1lIjoiRGlub3IiLCJpbl9jb3JwIjoidHJ1ZSIsImlwYWRkciI6Ijc5LjE4My4zOC4yMzYiLCJuYW1lIjoiRGlub3IgR2VsZXIiLCJvaWQiOiI0ZGNlNTBlZS1jMmRjLTRkMDMtYWIyYi05ZTE1YTBjMWQ3ZTIiLCJvbnByZW1fc2lkIjoiUy0xLTUtMjEtNzIwNTE2MDctMTc0NTc2MDAzNi0xMDkxODc5NTYtMTMyNTUwIiwicHVpZCI6IjEwMDMzRkZGODAxQzI2RTgiLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJzdWIiOiJlVmQyYjlKRVlYaXFOUW5xQnltQkJITjhaMGxFdEhQWFQ4cmdBTFc5UGhvIiwidGlkIjoiNzJmOTg4YmYtODZmMS00MWFmLTkxYWItMmQ3Y2QwMTFkYjQ3IiwidW5pcXVlX25hbWUiOiJkaWdlbGVyQG1pY3Jvc29mdC5jb20iLCJ1cG4iOiJkaWdlbGVyQG1pY3Jvc29mdC5jb20iLCJ1dGkiOiJBcDZJTV9Udk0wLXRrYmNoaUZnSkFBIiwidmVyIjoiMS4wIn0.Jq9iDkDgi0-RX1TmPBnzGXZEPKkOh8LlbLRrPCbITsV948c9N14zy8zKxKZfUUEIp5cDfMOmF7kPnIqIg2zxcBVB42fv62uBDc4cPf1pq1kF_Yg4_sGCigVaUgQn78zpcUawZpucnXnW-aebqUFoEvfc6Ezf6dB4MyOs2E0SR_2BqugJgyEyrFTU-kpcSuZKNQktSu8DGz0LK4hVsJHGR_H8O94_xR0xdnPfeA60QB-jk9HdUHKt6f3SV747AcTtPm_1_EllyqgrQHz1buRpoaMKOE-nRypkm-TreFJDoTMC_4FQhFXSQma8R5_" --set newssh="ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDeITtd7lF0QiLAnXS06GCFIxZ/6BJJgmfAjVUbNgCiOtx45rQUTlwIhTkvydXBCN2oWBsa/3zAKmr51FzXkPHRkr236bREKf0Y0nZqFbGaAmZ85lFdmTc2c3oPkw1kHMDoNxRCqgu/EPMMJZ4o7GBk4Jnu0Jbz0cnc98PUDBEg7LdhrpFPw1lEAKTJu1ESwCR8PK4zP5T4GZbTvAFfx/TQIX3SXjkHkBzblNWvJHUh615dze1jhu61435435456756ggfgfgfgfggfgf1C6Ep5rjgosRp30PUFcmdNIDyFXeU0LUw/wUIWMe9Ncm7VoDUgexdjj+P dinorgeler@win10.nma.lab" --set location="East US" 

the code will find all the nodes in the Mc_ RG and reset the password for each node to azureuser and the above new ssh.

3. Once its done use kubectp cp to copy the private key to the sshaccess pod.
4. then exec into the pod and use ssh -i [your private key] azureuser@1.2.3.4
5. you should be able to connect to any node in the MC rg.

